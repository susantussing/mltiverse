import React from 'react';
import { CircularProgress, Paper, withStyles } from '@material-ui/core';
import clsx from 'clsx';
import ScrollableFeed from './ScrollableFeed';

const styles = (theme) => ({
  outputWindow: {
    margin: theme.spacing(1),
    padding: theme.spacing(2),
    backgroundColor: 'black',
    color: 'white',
    fontFamily: 'Fira Code',
    overflowY: 'scroll',
    height: '320px',
    whiteSpace: 'pre-wrap',
    fontSize: '0.75rem',
  },
  output: {
    color: 'white',
  },
  unread: {
    backgroundColor: '#eee',
  },
  history: {
    margin: 0,
    marginBottom: theme.spacing(1),
    paddingLeft: theme.spacing(1),
  },
  input: {
    color: theme.palette.secondary.light,
    border: 0,
    borderLeft: '1px solid',
    borderColor: theme.palette.secondary.light,
  },
});

function Output({
  data, loading, classes,
}) {
  const unread = 0;
  return (
    <Paper className={classes.outputWindow}>
      {loading ? <CircularProgress />
        : (
          <ScrollableFeed alwaysScroll={false}>
            {data && data.historyLineMany.map((historyLine, index) => (
              <p
                className={clsx(
                  classes.history,
                  classes[historyLine.type],
                  data.historyLineMany.length - unread <= index && classes.unread,
                )}
                key={historyLine._id}
                title={historyLine.createdAt?.toString()}
              // The HTML here should all be generated by the server.  Mostly for ANSI classes.
              // eslint-disable-next-line react/no-danger
                dangerouslySetInnerHTML={{ __html: historyLine.line }}
              />
            ))}
          </ScrollableFeed>
        )}
    </Paper>
  );
}

export default withStyles(styles)(Output);
